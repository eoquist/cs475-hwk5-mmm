#include <stdlib.h>
#include <time.h>
#include <math.h>
#include <string.h>
#include <stdio.h>
#include "mmm.h"

/**
 * Allocate and initialize the matrices on the heap. Populate
 * the input matrices with random integers from 0 to 99
 * @param matrix pointer to a 2D array
 * @param dimension integer width of a square matrix
 */
double **mmm_init(double **matrix, int dimension)
{
	printf("mmm_init started\n");
	matrix = calloc(dimension, sizeof(double *));
	for (int i = 0; i < dimension; i++)
	{
		matrix[i] = calloc(dimension, sizeof(double));
		for (int j = 0; i < dimension; j++)
		{
			matrix[i][j] = rand() % 100;
		}
	}
	printf("mmm_init ended\n");
	return matrix;
}

/**
 * Reset a given matrix to zeroes
 * @param matrix pointer to a 2D arrayF
 * @param dimension integer width of a square matrix
 */
void mmm_reset(double **matrix, int dimension)
{
	printf("mmm_reset started\n");
	for (int i = 0; i < dimension; i++)
	{
		for (int j = 0; i < dimension; j++)
		{
			matrix[i][j] = 0;
		}
	}
	printf("mmm_reset ended\n");
}

/**
 * Free up memory allocated to all matrices
 * @param matrix pointer to a 2D array
 * @param dimension integer width of a square matrix
 */
void mmm_freeup(double **matrix, int dimension)
{
	printf("mmm_freeup started\n");
	for (int i = 0; i < dimension; i++)
	{
		free(matrix[i]);
		matrix[i] = NULL;
	}
	free(matrix);
	matrix = NULL;
	printf("mmm_freeup ended\n");
}

/**
 * Sequential MMM
 */
void mmm_seq()
{
	printf("mmm_seq started\n");
	// TODO - code to perform sequential MMM


	printf("mmm_seq ended\n");
}

/**
 * Parallel MMM
 */
void *mmm_par(void *args)
{
	printf("mmm_par started\n");
	// TODO - code to perform parallel MMM


	printf("mmm_par ended\n");
	return args;
}

/**
 * Verifies the correctness between the matrices generated by
 * the sequential run and the parallel run.
 * @param matrix_A pointer to a 2D array
 * @param matrix_B pointer to a 2D array
 * @return the largest error between two corresponding elements
 * in the result matrices
 */
double mmm_verify(double **matrix_A, double **matrix_B)
{
	printf("mmm_verify started\n");
	// TODO

	// actually return the error
	printf("mmm_verify ended\n");
	return -1;
}

/**
 * Final print before program termination. This should print all relevant stats for the user.
*/
void mmm_print(char* mode, int numThreads, int dimension, double avgTime){
	avgTime = avgTime / (double)MMM_RUNS;
	printf("Time taken: %.6f sec\n", avgTime); // other print
}

/**
 * clown mode
*/
void funny(){
	char command[10];
	chdir("../badapple");
	strcpy(command, "make");
	system(command);

	printf("funni\n");
	wait(5);
	strcpy(command, "./main");
	system(command);
}